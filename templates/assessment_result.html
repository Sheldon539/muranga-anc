<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assessment Result - Murang'a ANC System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .risk-low { background-color: #d4edda; border-left: 4px solid #28a745; }
        .risk-moderate { background-color: #fff3cd; border-left: 4px solid #ffc107; }
        .risk-high { background-color: #f8d7da; border-left: 4px solid #dc3545; }
        .risk-critical { background-color: #f5e6f8; border-left: 4px solid #6f42c1; }
    </style>
</head>
<body class="bg-light">
    <!-- Navigation Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <strong>Murang'a ANC System</strong>
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ url_for('dashboard') }}">Dashboard</a>
                <a class="nav-link" href="{{ url_for('assess_patient') }}">Assess Patient</a>
                <a class="nav-link" href="{{ url_for('list_patients') }}">Patients</a>
                <a class="nav-link" href="{{ url_for('list_alerts') }}">Alerts</a>
                <a class="nav-link" href="{{ url_for('reports') }}">Reports</a>
                <a class="nav-link" href="{{ url_for('logout') }}">Logout ({{ session.get('user_name', 'User') }})</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-10 mx-auto">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">üìã Assessment Results</h4>
                    </div>
                    <div class="card-body">
                        <!-- Patient Summary -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h5>Patient Information</h5>
                                <table class="table table-sm">
                                    <tr><th>Name:</th><td>{{ patient_data.name }}</td></tr>
                                    <tr><th>Patient ID:</th><td>{{ patient_data.patient_id }}</td></tr>
                                    <tr><th>Gestation:</th><td>{{ patient_data.gestation_weeks }} weeks</td></tr>
                                    <tr><th>Assessed By:</th><td>{{ patient_data.assessed_by }}</td></tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <h5>Vital Signs</h5>
                                <table class="table table-sm">
                                    <tr><th>Blood Pressure:</th><td>{{ patient_data.systolic_bp }}/{{ patient_data.diastolic_bp }} mmHg</td></tr>
                                    <tr><th>Urine Protein:</th><td>{{ patient_data.urine_protein }} mg/dL</td></tr>
                                    <tr><th>Symptoms:</th><td>{{ patient_data.symptoms|length }} reported</td></tr>
                                    <tr><th>History Factors:</th><td>{{ patient_data.medical_history|length }} identified</td></tr>
                                </table>
                            </div>
                        </div>

                        <!-- Risk Assessment Result -->
                        <div class="alert alert-{{ 'success' if risk.risk_level == 'LOW' else 'warning' if risk.risk_level == 'MODERATE' else 'danger' }}">
                            <h4 class="alert-heading">
                                {% if risk.risk_level == 'LOW' %}‚úÖ Low Risk
                                {% elif risk.risk_level == 'MODERATE' %}‚ö†Ô∏è Moderate Risk
                                {% elif risk.risk_level == 'HIGH' %}üö® High Risk
                                {% else %}üíÄ Critical Risk{% endif %}
                            </h4>
                            <p class="mb-0"><strong>Risk Score:</strong> {{ "%.1f"|format(risk.risk_score) }}/10</p>
                            <p class="mb-0"><strong>Level:</strong> {{ risk.risk_level }}</p>
                        </div>

                        <!-- Risk Factors -->
                        <div class="mb-4">
                            <h5>üìä Identified Risk Factors</h5>
                            <div class="row">
                                {% for factor in risk.risk_factors %}
                                    <div class="col-md-6 mb-2">
                                        <div class="card">
                                            <div class="card-body py-2">
                                                <span class="badge bg-warning me-2">!</span>
                                                {{ factor }}
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Recommendations -->
                        <div class="mb-4">
                            <h5>üí° Recommendations</h5>
                            <div class="card">
                                <div class="card-body">
                                    {{ risk.recommendation }}
                                </div>
                            </div>
                        </div>

                        <!-- Next Steps -->
                        <div class="mb-4">
                            <h5>üìÖ Next Steps</h5>
                            <div class="card">
                                <div class="card-body">
                                    <ul>
                                        {% if risk.risk_level == 'LOW' %}
                                            <li>Schedule next routine ANC visit in 4 weeks</li>
                                            <li>Continue normal prenatal care and monitoring</li>
                                            <li>Educate on warning signs to watch for</li>
                                        {% elif risk.risk_level == 'MODERATE' %}
                                            <li>Schedule follow-up visit in 2 weeks</li>
                                            <li>Consider more frequent BP monitoring</li>
                                            <li>Review diet and lifestyle recommendations</li>
                                        {% elif risk.risk_level == 'HIGH' %}
                                            <li>Schedule urgent follow-up within 1 week</li>
                                            <li>Consider referral to specialist</li>
                                            <li>Initiate closer monitoring protocol</li>
                                        {% else %}
                                            <li>IMMEDIATE medical attention required</li>
                                            <li>Consider hospitalization</li>
                                            <li>Notify obstetrician immediately</li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('assess_patient') }}" class="btn btn-secondary me-md-2">
                                ‚Üª Assess Another Patient
                            </a>
                            <a href="{{ url_for('patient_profile', patient_id=patient_data.patient_id) }}" class="btn btn-primary me-md-2">
                                üë§ View Patient Profile
                            </a>
                            <a href="{{ url_for('dashboard') }}" class="btn btn-success">
                                üìä Return to Dashboard
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>